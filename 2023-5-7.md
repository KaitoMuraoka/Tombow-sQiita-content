<!--
title: 【Swift, Kotlin】Swift・Kotlinで学ぶ関数の抽出・関数のインライン化
tags:  Swift, Kotlin, リファクタリング
private: false
-->

# 記事の背景
リファクタリングについて勉強しているから、そのSwift版、Kotlin版を書いていくで〜。

# 本論
## 関数の抽出
関数の抽出は、リファクタリングで頻繁に行われる手法です。
コードの一部を分析し、その機能を理解した上で独立した関数として取り出し、その目的を示す名前をつけます。

多くの開発者は、どのタイミングでコードを別の関数に分けるべきかについて議論する。
一部のガイドラインでは、「関数は一画面に収めるべき」といった長さに基づいたアドバイスや、「2回以上使われるコードは関数にすべき」という再利用に基づいたアドバイスなどがあります。
しかし、最も理解しやすいのは、**目的と実装を分離する**という考え方です。
何をしているのか調べなければわからないコードの断片があるとしたら、「何」をしているのかを示す名前の関数として抽出すべきです。
そうすれば関数名を読み返すだけで関数の目的がすぐに伝わります。

このような小さい関数は名前が良くないと意味がない。
そのため、命名に細心の注意を払う必要があります。

大きな関数の中には、何をするかを説明したコメントで始まるコードの断片が見つかることがよくあります。
そのコメントは、関数としてその断片を抽出するのに相応しい名前を示唆してくれます。

## 手段
- 新たな関数を作り、その意図に沿って命名する（何をするかで命名する）
    - 1回呼び出すだけのコードのように、抽出したいコードが単純な場合でも、新しい関数名がコードの意図をより適切に表現するなら抽出する。意味のある名前が思いつかない・見つからない場合は、今は抽出はせず、思い浮かんだら抽出する
- 抽出したいコードを元の関数から新たな関数にコピーする
- 抽出したコードを調べて、元の関数ではスコープ内だった変数を特定し、引数として渡す。
    - 代入される変数が値私になっているか注意すること。1つだけなら、抽出されたコードを問い合わせとして扱い、戻り値をその変数に代入する(クロージャー)を試みる。
    - 抽出したコード内で代入されるローカル変数が多すぎる場合は、その時は抽出は諦め、変数分離や問い合わせによる一時変数の置き換えといった変数の使い方を整理してから抽出に取り組む
- 全ての変数を処理したらコンパイル＆ビルド
- 元の関数に残った抽出前コードを、抽出した関数への呼び出しに置き換える
- テストして、残りのコードを見て、抽出したコードと同じ、または類似したコードを探し、新しい関数を呼ぶ形にできないか検討する